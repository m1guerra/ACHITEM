[
  ACH.LOOKUP
]


TARGET=ACCOUNT

DEFINE
  STARTDATE = DATE
  ENDDATE = DATE
  TEMPCOUNT = NUMBER
  TEMPLASTDATE = DATE
  COMPANYID1 = STRING
  COMPANYID2 = STRING
END

SETUP
  STARTDATE = DATEREAD("Enter Start Date")
  ENDDATE = DATEREAD("Enter End Date")
  COMPANYID1 = ""
  COMPANYID2 = ""
END

PRINT TITLE="ACH ITEMS"
    HEADERS 
        COL=001 "ACCOUNT NUMBER"
        COL=016 "MEMBER NAME"
        COL=030 "BIRTH DATE"
        COL=040 "EMAIL ADDRESS"
        COL=090 "MEMBER GROUP"
        COL=100 "LAST DIRECT DEPOSIT"
        NEWLINE
        COL=001 REPEATCHR("-",132)
        NEWLINE
    END [HEADERS]

    TEMPCOUNT = 0
    TEMPLASTDATE = '--/--/--'
    LASTDATE = '--/--/--'

    CALL ACHITEMPROC

    IF TEMPCOUNT > 0 THEN
    DO
      COL = 001 ACCOUNT:NUMBER
      COL = 016 NAME:SHORTNAME
      COL = 030 NAME:BIRTHDATE
      COL = 040 NAME:EMAIL
      COL = 090 ACCOUNT:MEMBERGROUP
      COL = 100 LASTDATE
      NEWLINE
    END
END 

PROCEDURE ACHITEMPROC
  FOR ACHITEM WITH ACCOUNT ACCOUNT:NUMBER
   DO
    IF (ACHITEM:COMPANYID = COMPANYID1
        OR ACHITEM:COMPANYID = COMPANYID2 ) THEN 
     DO
      IF (ACHITEM:TRANPOSTDATE >= STARTDATE
          AND ACHITEM:TRANPOSTDATE <= ENDDATE) THEN
       DO
        TEMPCOUNT = TEMPCOUNT + 1
        TEMPLASTDATE = ACHITEM:TRANPOSTDATE
        
        IF TEMPLASTDATE > LASTDATE THEN
        DO
          LASTDATE = ACHITEM:TRANPOSTDATE
        END
       END
     END
   END
END [ACHITEM]
